(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _math = require('../../utils/math.js');

var _dom = require('../../utils/dom.js');

var name = 'parkinsons';
var cssUrl = chrome.extension.getURL('/simulations/parkinsons/css/main.css');
var shakeSpeed = 60;
var shakePositionInterval = 1500;
var appVersion = navigator.appVersion;

var cursorImgUrl = '',
    cursor = null,
    posInterval = null,
    cursorPosX = 0,
    cursorPosY = 0,
    viewportPosX = 0,
    viewportPosY = 0,
    offsetX = 0,
    offsetY = 0,
    css = null,
    clickedElement = null;

function mousemoveHandler(e) {
  // Save the position of the fake cursor
  cursorPosX = e.pageX + offsetX;
  cursorPosY = e.pageY + offsetY;

  // Save the viewport position of the fake cursor (position without scroll)
  // We use this later to get the clicked element
  viewportPosX = e.clientX + offsetX;
  viewportPosY = e.clientY + offsetY;

  (0, _dom.setStyle)(cursor, { left: cursorPosX + 'px', top: cursorPosY + 'px', transition: 'left 0.05s, top 0.05s' });
}

function elementClickHandler(e) {

  if (e.target === clickedElement) {
    // Actual mouse clicked element is the same as the element that the fake cursor would click.
    // This is because we triggered the click or that the positions of the mouse and the fake cursor are both over the same element.
    // Do nothing and pass on the click. Reset the clicked element.
    clickedElement = null;
  } else {
    // Actual mouse clicked element is NOT the same as the element that the fake cursor would click.
    // Get the element that the fake cursor would click and trigger click on that element.
    e.preventDefault();

    clickedElement = document.elementFromPoint(viewportPosX, viewportPosY);

    if (clickedElement) {
      clickedElement.click();
    }
  }
}

function setOffset() {
  offsetX = (0, _math.random)(-shakeSpeed, shakeSpeed);
  offsetY = (0, _math.random)(-shakeSpeed, shakeSpeed);
}

function start() {

  var cursorImg = appVersion.includes('Mac') ? 'cursor_mac.svg' : 'cursor_windows.svg';
  var cursorImgUrl = chrome.extension.getURL('/simulations/parkinsons/img/' + cursorImg);

  css = (0, _dom.addCss)(cssUrl);

  cursor = document.createElement('div');

  cursor.style.background = 'url(' + cursorImgUrl + ')';
  cursor.setAttribute('id', 'wds-parkinsonsCursor');

  document.body.appendChild(cursor);

  document.addEventListener('mousemove', mousemoveHandler);

  document.addEventListener('click', elementClickHandler);

  posInterval = setInterval(setOffset, shakePositionInterval);
}

function stop() {

  if (cursor) {
    (0, _dom.removeElement)(cursor);
  }

  if (css) {
    (0, _dom.removeElement)(css);
  }

  if (posInterval) {
    clearInterval(posInterval);
  }

  // TODO: remove listeners
}

chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
  if (request.action === 'startSimulation' && request.simulation === name) {
    start();
  } else if (request.action === 'stopSimulation' && request.simulation === name) {
    stop();
  }
});


},{"../../utils/dom.js":2,"../../utils/math.js":3}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addCss = addCss;
exports.addScript = addScript;
exports.addStyle = addStyle;
exports.appendHTML = appendHTML;
exports.getTextNodes = getTextNodes;
exports.removeElement = removeElement;
exports.setStyle = setStyle;
function addCss(href, callback) {
  var l = document.createElement('link');
  l.setAttribute('href', href);
  l.setAttribute('rel', 'stylesheet');
  l.onload = callback;
  document.getElementsByTagName('head')[0].appendChild(l);
  return l;
}

function addScript(src, callback) {
  var s = document.createElement('script');
  s.setAttribute('src', src);
  s.onload = callback;
  document.getElementsByTagName('head')[0].appendChild(s);
  return s;
}

function addStyle(str) {
  var s = document.createElement('style');
  s.innerText = str;
  document.getElementsByTagName('head')[0].appendChild(s);
  return s;
}

function appendHTML(el, html) {
  var tmpEl = document.createElement('div');
  tmpEl.innerHTML = html;

  while (tmpEl.firstChild) {
    el.appendChild(tmpEl.firstChild);
  }
}

function getTextNodes(node) {
  var all = [];
  for (node = node.firstChild; node; node = node.nextSibling) {
    if (node.nodeType == 3) all.push(node);else all = all.concat(getTextNodes(node));
  }
  return all;
}

function removeElement(el) {
  el.parentNode.removeChild(el);
}

function setStyle(element, style) {
  for (var s in style) {
    element.style[s] = style[s];
  }
}


},{}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.random = random;
exports.pointInRect = pointInRect;
exports.inRange = inRange;
function random(min, max) {
  return Math.floor(min + Math.random() * (max - min + 1));
}

function pointInRect(x, y, rect) {
  return inRange(x, rect.x, rect.x + rect.width) && inRange(y, rect.y, rect.y + rect.height);
}

function inRange(value, min, max) {
  return value >= Math.min(min, max) && value <= Math.max(min, max);
}


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJidWlsZFxcanNcXGJhYmVsXFxzaW11bGF0aW9uc1xccGFya2luc29uc1xcY29udGVudC5qcyIsImJ1aWxkXFxqc1xcYmFiZWxcXHV0aWxzXFxkb20uanMiLCJidWlsZFxcanNcXGJhYmVsXFx1dGlsc1xcbWF0aC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBOztBQUVBLElBQUksUUFBUSxRQUFRLHFCQUFSLENBQVo7O0FBRUEsSUFBSSxPQUFPLFFBQVEsb0JBQVIsQ0FBWDs7QUFFQSxJQUFJLE9BQU8sWUFBWDtBQUNBLElBQUksU0FBUyxPQUFPLFNBQVAsQ0FBaUIsTUFBakIsQ0FBd0Isc0NBQXhCLENBQWI7QUFDQSxJQUFJLGFBQWEsRUFBakI7QUFDQSxJQUFJLHdCQUF3QixJQUE1QjtBQUNBLElBQUksYUFBYSxVQUFVLFVBQTNCOztBQUVBLElBQUksZUFBZSxFQUFuQjtBQUFBLElBQ0ksU0FBUyxJQURiO0FBQUEsSUFFSSxjQUFjLElBRmxCO0FBQUEsSUFHSSxhQUFhLENBSGpCO0FBQUEsSUFJSSxhQUFhLENBSmpCO0FBQUEsSUFLSSxlQUFlLENBTG5CO0FBQUEsSUFNSSxlQUFlLENBTm5CO0FBQUEsSUFPSSxVQUFVLENBUGQ7QUFBQSxJQVFJLFVBQVUsQ0FSZDtBQUFBLElBU0ksTUFBTSxJQVRWO0FBQUEsSUFVSSxpQkFBaUIsSUFWckI7O0FBWUEsU0FBUyxnQkFBVCxDQUEwQixDQUExQixFQUE2QjtBQUMzQjtBQUNBLGVBQWEsRUFBRSxLQUFGLEdBQVUsT0FBdkI7QUFDQSxlQUFhLEVBQUUsS0FBRixHQUFVLE9BQXZCOztBQUVBO0FBQ0E7QUFDQSxpQkFBZSxFQUFFLE9BQUYsR0FBWSxPQUEzQjtBQUNBLGlCQUFlLEVBQUUsT0FBRixHQUFZLE9BQTNCOztBQUVBLEdBQUMsR0FBRyxLQUFLLFFBQVQsRUFBbUIsTUFBbkIsRUFBMkIsRUFBRSxNQUFNLGFBQWEs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Q2hDLFNBQU8sU0FBUyxLQUFLLEdBQUwsQ0FBUyxHQUFULEVBQWMsR0FBZCxDQUFULElBQStCLFNBQVMsS0FBSyxHQUFMLENBQVMsR0FBVCxFQUFjLEdBQWQsQ0FBL0M7QUFDRDtBQUNEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIF9tYXRoID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvbWF0aC5qcycpO1xuXG52YXIgX2RvbSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2RvbS5qcycpO1xuXG52YXIgbmFtZSA9ICdwYXJraW5zb25zJztcbnZhciBjc3NVcmwgPSBjaHJvbWUuZXh0ZW5zaW9uLmdldFVSTCgnL3NpbXVsYXRpb25zL3BhcmtpbnNvbnMvY3NzL21haW4uY3NzJyk7XG52YXIgc2hha2VTcGVlZCA9IDYwO1xudmFyIHNoYWtlUG9zaXRpb25JbnRlcnZhbCA9IDE1MDA7XG52YXIgYXBwVmVyc2lvbiA9IG5hdmlnYXRvci5hcHBWZXJzaW9uO1xuXG52YXIgY3Vyc29ySW1nVXJsID0gJycsXG4gICAgY3Vyc29yID0gbnVsbCxcbiAgICBwb3NJbnRlcnZhbCA9IG51bGwsXG4gICAgY3Vyc29yUG9zWCA9IDAsXG4gICAgY3Vyc29yUG9zWSA9IDAsXG4gICAgdmlld3BvcnRQb3NYID0gMCxcbiAgICB2aWV3cG9ydFBvc1kgPSAwLFxuICAgIG9mZnNldFggPSAwLFxuICAgIG9mZnNldFkgPSAwLFxuICAgIGNzcyA9IG51bGwsXG4gICAgY2xpY2tlZEVsZW1lbnQgPSBudWxsO1xuXG5mdW5jdGlvbiBtb3VzZW1vdmVIYW5kbGVyKGUpIHtcbiAgLy8gU2F2ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGZha2UgY3Vyc29yXG4gIGN1cnNvclBvc1ggPSBlLnBhZ2VYICsgb2Zmc2V0WDtcbiAgY3Vyc29yUG9zWSA9IGUucGFnZVkgKyBvZmZzZXRZO1xuXG4gIC8vIFNhdmUgdGhlIHZpZXdwb3J0IHBvc2l0aW9uIG9mIHRoZSBmYWtlIGN1cnNvciAocG9zaXRpb24gd2l0aG91dCBzY3JvbGwpXG4gIC8vIFdlIHVzZSB0aGlzIGxhdGVyIHRvIGdldCB0aGUgY2xpY2tlZCBlbGVtZW50XG4gIHZpZXdwb3J0UG9zWCA9IGUuY2xpZW50WCArIG9mZnNldFg7XG4gIHZpZXdwb3J0UG9zWSA9IGUuY2xpZW50WSArIG9mZnNldFk7XG5cbiAgKDAsIF9kb20uc2V0U3R5bGUpKGN1cnNvciwgeyBsZWZ0OiBjdXJzb3JQb3NYICsgJ3B4JywgdG9wOiBjdXJzb3JQb3NZICsgJ3B4JywgdHJhbnNpdGlvbjogJ2xlZnQgMC4wNXMsIHRvcCAwLjA1cycgfSk7XG59XG5cbmZ1bmN0aW9uIGVsZW1lbnRDbGlja0hhbmRsZXIoZSkge1xuXG4gIGlmIChlLnRhcmdldCA9PT0gY2xpY2tlZEVsZW1lbnQpIHtcbiAgICAvLyBBY3R1YWwgbW91c2UgY2xpY2tlZCBlbGVtZW50IGlzIHRoZSBzYW1lIGFzIHRoZSBlbGVtZW50IHRoYXQgdGhlIGZha2UgY3Vyc29yIHdvdWxkIGNsaWNrLlxuICAgIC8vIFRoaXMgaXMgYmVjYXVzZSB3ZSB0cmlnZ2VyZWQgdGhlIGNsaWNrIG9yIHRoYXQgdGhlIHBvc2l0aW9ucyBvZiB0aGUgbW91c2UgYW5kIHRoZSBmYWtlIGN1cnNvciBhcmUgYm90aCBvdmVyIHRoZSBzYW1lIGVsZW1lbnQuXG4gICAgLy8gRG8gbm90aGluZyBhbmQgcGFzcyBvbiB0aGUgY2xpY2suIFJlc2V0IHRoZSBjbGlja2VkIGVsZW1lbnQuXG4gICAgY2xpY2tlZEVsZW1lbnQgPSBudWxsO1xuICB9IGVsc2Uge1xuICAgIC8vIEFjdHVhbCBtb3VzZSBjbGlja2VkIGVsZW1lbnQgaXMgTk9UIHRoZSBzYW1lIGFzIHRoZSBlbGVtZW50IHRoYXQgdGhlIGZha2UgY3Vyc29yIHdvdWxkIGNsaWNrLlxuICAgIC8vIEdldCB0aGUgZWxlbWVudCB0aGF0IHRoZSBmYWtlIGN1cnNvciB3b3VsZCBjbGljayBhbmQgdHJpZ2dlciBjbGljayBvbiB0aGF0IGVsZW1lbnQuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgY2xpY2tlZEVsZW1lbnQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KHZpZXdwb3J0UG9zWCwgdmlld3BvcnRQb3NZKTtcblxuICAgIGlmIChjbGlja2VkRWxlbWVudCkge1xuICAgICAgY2xpY2tlZEVsZW1lbnQuY2xpY2soKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0T2Zmc2V0KCkge1xuICBvZmZzZXRYID0gKDAsIF9tYXRoLnJhbmRvbSkoLXNoYWtlU3BlZWQsIHNoYWtlU3BlZWQpO1xuICBvZmZzZXRZID0gKDAsIF9tYXRoLnJhbmRvbSkoLXNoYWtlU3BlZWQsIHNoYWtlU3BlZWQpO1xufVxuXG5mdW5jdGlvbiBzdGFydCgpIHtcblxuICB2YXIgY3Vyc29ySW1nID0gYXBwVmVyc2lvbi5pbmNsdWRlcygnTWFjJykgPyAnY3Vyc29yX21hYy5zdmcnIDogJ2N1cnNvcl93aW5kb3dzLnN2Zyc7XG4gIHZhciBjdXJzb3JJbWdVcmwgPSBjaHJvbWUuZXh0ZW5zaW9uLmdldFVSTCgnL3NpbXVsYXRpb25zL3BhcmtpbnNvbnMvaW1nLycgKyBjdXJzb3JJbWcpO1xuXG4gIGNzcyA9ICgwLCBfZG9tLmFkZENzcykoY3NzVXJsKTtcblxuICBjdXJzb3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjdXJzb3Iuc3R5bGUuYmFja2dyb3VuZCA9ICd1cmwoJyArIGN1cnNvckltZ1VybCArICcpJztcbiAgY3Vyc29yLnNldEF0dHJpYnV0ZSgnaWQnLCAnd2RzLXBhcmtpbnNvbnNDdXJzb3InKTtcblxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGN1cnNvcik7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW91c2Vtb3ZlSGFuZGxlcik7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlbGVtZW50Q2xpY2tIYW5kbGVyKTtcblxuICBwb3NJbnRlcnZhbCA9IHNldEludGVydmFsKHNldE9mZnNldCwgc2hha2VQb3NpdGlvbkludGVydmFsKTtcbn1cblxuZnVuY3Rpb24gc3RvcCgpIHtcblxuICBpZiAoY3Vyc29yKSB7XG4gICAgKDAsIF9kb20ucmVtb3ZlRWxlbWVudCkoY3Vyc29yKTtcbiAgfVxuXG4gIGlmIChjc3MpIHtcbiAgICAoMCwgX2RvbS5yZW1vdmVFbGVtZW50KShjc3MpO1xuICB9XG5cbiAgaWYgKHBvc0ludGVydmFsKSB7XG4gICAgY2xlYXJJbnRlcnZhbChwb3NJbnRlcnZhbCk7XG4gIH1cblxuICAvLyBUT0RPOiByZW1vdmUgbGlzdGVuZXJzXG59XG5cbmNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbiAocmVxdWVzdCwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpIHtcbiAgaWYgKHJlcXVlc3QuYWN0aW9uID09PSAnc3RhcnRTaW11bGF0aW9uJyAmJiByZXF1ZXN0LnNpbXVsYXRpb24gPT09IG5hbWUpIHtcbiAgICBzdGFydCgpO1xuICB9IGVsc2UgaWYgKHJlcXVlc3QuYWN0aW9uID09PSAnc3RvcFNpbXVsYXRpb24nICYmIHJlcXVlc3Quc2ltdWxhdGlvbiA9PT0gbmFtZSkge1xuICAgIHN0b3AoKTtcbiAgfVxufSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb250ZW50LmpzLm1hcFxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5hZGRDc3MgPSBhZGRDc3M7XG5leHBvcnRzLmFkZFNjcmlwdCA9IGFkZFNjcmlwdDtcbmV4cG9ydHMuYWRkU3R5bGUgPSBhZGRTdHlsZTtcbmV4cG9ydHMuYXBwZW5kSFRNTCA9IGFwcGVuZEhUTUw7XG5leHBvcnRzLmdldFRleHROb2RlcyA9IGdldFRleHROb2RlcztcbmV4cG9ydHMucmVtb3ZlRWxlbWVudCA9IHJlbW92ZUVsZW1lbnQ7XG5leHBvcnRzLnNldFN0eWxlID0gc2V0U3R5bGU7XG5mdW5jdGlvbiBhZGRDc3MoaHJlZiwgY2FsbGJhY2spIHtcbiAgdmFyIGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gIGwuc2V0QXR0cmlidXRlKCdocmVmJywgaHJlZik7XG4gIGwuc2V0QXR0cmlidXRlKCdyZWwnLCAnc3R5bGVzaGVldCcpO1xuICBsLm9ubG9hZCA9IGNhbGxiYWNrO1xuICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKGwpO1xuICByZXR1cm4gbDtcbn1cblxuZnVuY3Rpb24gYWRkU2NyaXB0KHNyYywgY2FsbGJhY2spIHtcbiAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgcy5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNyYyk7XG4gIHMub25sb2FkID0gY2FsbGJhY2s7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQocyk7XG4gIHJldHVybiBzO1xufVxuXG5mdW5jdGlvbiBhZGRTdHlsZShzdHIpIHtcbiAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICBzLmlubmVyVGV4dCA9IHN0cjtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzKTtcbiAgcmV0dXJuIHM7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZEhUTUwoZWwsIGh0bWwpIHtcbiAgdmFyIHRtcEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHRtcEVsLmlubmVySFRNTCA9IGh0bWw7XG5cbiAgd2hpbGUgKHRtcEVsLmZpcnN0Q2hpbGQpIHtcbiAgICBlbC5hcHBlbmRDaGlsZCh0bXBFbC5maXJzdENoaWxkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRUZXh0Tm9kZXMobm9kZSkge1xuICB2YXIgYWxsID0gW107XG4gIGZvciAobm9kZSA9IG5vZGUuZmlyc3RDaGlsZDsgbm9kZTsgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpIHtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAzKSBhbGwucHVzaChub2RlKTtlbHNlIGFsbCA9IGFsbC5jb25jYXQoZ2V0VGV4dE5vZGVzKG5vZGUpKTtcbiAgfVxuICByZXR1cm4gYWxsO1xufVxuXG5mdW5jdGlvbiByZW1vdmVFbGVtZW50KGVsKSB7XG4gIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xufVxuXG5mdW5jdGlvbiBzZXRTdHlsZShlbGVtZW50LCBzdHlsZSkge1xuICBmb3IgKHZhciBzIGluIHN0eWxlKSB7XG4gICAgZWxlbWVudC5zdHlsZVtzXSA9IHN0eWxlW3NdO1xuICB9XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kb20uanMubWFwXG4iLCJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMucmFuZG9tID0gcmFuZG9tO1xuZXhwb3J0cy5wb2ludEluUmVjdCA9IHBvaW50SW5SZWN0O1xuZXhwb3J0cy5pblJhbmdlID0gaW5SYW5nZTtcbmZ1bmN0aW9uIHJhbmRvbShtaW4sIG1heCkge1xuICByZXR1cm4gTWF0aC5mbG9vcihtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKTtcbn1cblxuZnVuY3Rpb24gcG9pbnRJblJlY3QoeCwgeSwgcmVjdCkge1xuICByZXR1cm4gaW5SYW5nZSh4LCByZWN0LngsIHJlY3QueCArIHJlY3Qud2lkdGgpICYmIGluUmFuZ2UoeSwgcmVjdC55LCByZWN0LnkgKyByZWN0LmhlaWdodCk7XG59XG5cbmZ1bmN0aW9uIGluUmFuZ2UodmFsdWUsIG1pbiwgbWF4KSB7XG4gIHJldHVybiB2YWx1ZSA+PSBNYXRoLm1pbihtaW4sIG1heCkgJiYgdmFsdWUgPD0gTWF0aC5tYXgobWluLCBtYXgpO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWF0aC5qcy5tYXBcbiJdfQ==
