(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
'use strict';

var _math = require('../../utils/math.js');

var _dom = require('../../utils/dom.js');

var name = 'parkinsons';
var cssUrl = chrome.extension.getURL('/simulations/parkinsons/css/main.css');
var shakeSpeed = 40;
var shakePositionInterval = 250;
var appVersion = navigator.appVersion;

var cursor = null,
    posInterval = null,
    cursorPosX = 0,
    cursorPosY = 0,
    viewportPosX = 0,
    viewportPosY = 0,
    offsetX = 0,
    offsetY = 0,
    css = null,
    clickedElement = null;

function mousemoveHandler(e) {
  // Save the position of the fake cursor
  cursorPosX = e.pageX + offsetX;
  cursorPosY = e.pageY + offsetY;

  // Save the viewport position of the fake cursor (position without scroll)
  // We use this later to get the clicked element
  viewportPosX = e.clientX + offsetX;
  viewportPosY = e.clientY + offsetY;

  (0, _dom.setStyle)(cursor, { left: cursorPosX + 'px', top: cursorPosY + 'px', transition: 'left 0.05s, top 0.05s' });
}

function elementClickHandler(e) {

  if (e.target === clickedElement) {
    // Actual mouse clicked element is the same as the element that the fake cursor would click.
    // This is because we triggered the click or that the positions of the mouse and the fake cursor are both over the same element.
    // Do nothing and pass on the click. Reset the clicked element.
    clickedElement = null;
  } else {
    // Actual mouse clicked element is NOT the same as the element that the fake cursor would click.
    // Get the element that the fake cursor would click and trigger click on that element.
    e.preventDefault();

    clickedElement = document.elementFromPoint(viewportPosX, viewportPosY);

    if (clickedElement) {
      clickedElement.click();
    }
  }
}

function setOffset() {
  offsetX = (0, _math.random)(-shakeSpeed, shakeSpeed);
  offsetY = (0, _math.random)(-shakeSpeed, shakeSpeed);
}

function start() {

  var cursorImg = appVersion.includes('Mac') ? 'cursor_mac.svg' : 'cursor_windows.svg';
  var cursorImgUrl = chrome.extension.getURL('/simulations/parkinsons/img/' + cursorImg);

  css = (0, _dom.addCss)(cssUrl);

  cursor = document.createElement('div');

  cursor.style.background = 'url(' + cursorImgUrl + ')';
  cursor.setAttribute('id', 'wds-parkinsonsCursor');

  document.body.appendChild(cursor);

  document.addEventListener('mousemove', mousemoveHandler);

  document.addEventListener('click', elementClickHandler);

  posInterval = setInterval(setOffset, shakePositionInterval);
}

function stop() {

  if (cursor) {
    (0, _dom.removeElement)(cursor);
  }

  if (css) {
    (0, _dom.removeElement)(css);
  }

  if (posInterval) {
    clearInterval(posInterval);
  }

  // TODO: remove listeners
}

chrome.runtime.onMessage.addListener(function (request) {
  if (request.action === 'startSimulation' && request.simulation === name) {
    start();
  } else if (request.action === 'stopSimulation' && request.simulation === name) {
    stop();
  }
});


},{"../../utils/dom.js":2,"../../utils/math.js":3}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addCss = addCss;
exports.addScript = addScript;
exports.addStyle = addStyle;
exports.appendHTML = appendHTML;
exports.getTextNodes = getTextNodes;
exports.removeElement = removeElement;
exports.setStyle = setStyle;
function addCss(href, callback) {
  var l = document.createElement('link');
  l.setAttribute('href', href);
  l.setAttribute('rel', 'stylesheet');
  l.onload = callback;
  document.getElementsByTagName('head')[0].appendChild(l);
  return l;
}

function addScript(src, callback) {
  var s = document.createElement('script');
  s.setAttribute('src', src);
  s.onload = callback;
  document.getElementsByTagName('head')[0].appendChild(s);
  return s;
}

function addStyle(str) {
  var s = document.createElement('style');
  s.innerText = str;
  document.getElementsByTagName('head')[0].appendChild(s);
  return s;
}

function appendHTML(el, html) {
  var tmpEl = document.createElement('div');
  tmpEl.innerHTML = html;

  while (tmpEl.firstChild) {
    el.appendChild(tmpEl.firstChild);
  }
}

function getTextNodes(node) {
  var all = [];
  for (node = node.firstChild; node; node = node.nextSibling) {
    if (node.nodeType == 3) all.push(node);else all = all.concat(getTextNodes(node));
  }
  return all;
}

function removeElement(el) {
  el.parentNode.removeChild(el);
}

function setStyle(element, style) {
  for (var s in style) {
    element.style[s] = style[s];
  }
}


},{}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.random = random;
exports.pointInRect = pointInRect;
exports.inRange = inRange;
function random(min, max) {
  return Math.floor(min + Math.random() * (max - min + 1));
}

function pointInRect(x, y, rect) {
  return inRange(x, rect.x, rect.x + rect.width) && inRange(y, rect.y, rect.y + rect.height);
}

function inRange(value, min, max) {
  return value >= Math.min(min, max) && value <= Math.max(min, max);
}


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ncnVudC1icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJidWlsZC9qcy9iYWJlbC9zaW11bGF0aW9ucy9wYXJraW5zb25zL2NvbnRlbnQuanMiLCJidWlsZC9qcy9iYWJlbC91dGlscy9kb20uanMiLCJidWlsZC9qcy9iYWJlbC91dGlscy9tYXRoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7O0FBRUEsSUFBSSxRQUFRLFFBQVEscUJBQVIsQ0FBWjs7QUFFQSxJQUFJLE9BQU8sUUFBUSxvQkFBUixDQUFYOztBQUVBLElBQUksT0FBTyxZQUFYO0FBQ0EsSUFBSSxTQUFTLE9BQU8sU0FBUCxDQUFpQixNQUFqQixDQUF3QixzQ0FBeEIsQ0FBYjtBQUNBLElBQUksYUFBYSxFQUFqQjtBQUNBLElBQUksd0JBQXdCLEdBQTVCO0FBQ0EsSUFBSSxhQUFhLFVBQVUsVUFBM0I7O0FBRUEsSUFBSSxTQUFTLElBQWI7QUFBQSxJQUNJLGNBQWMsSUFEbEI7QUFBQSxJQUVJLGFBQWEsQ0FGakI7QUFBQSxJQUdJLGFBQWEsQ0FIakI7QUFBQSxJQUlJLGVBQWUsQ0FKbkI7QUFBQSxJQUtJLGVBQWUsQ0FMbkI7QUFBQSxJQU1JLFVBQVUsQ0FOZDtBQUFBLElBT0ksVUFBVSxDQVBkO0FBQUEsSUFRSSxNQUFNLElBUlY7QUFBQSxJQVNJLGlCQUFpQixJQVRyQjs7QUFXQSxTQUFTLGdCQUFULENBQTBCLENBQTFCLEVBQTZCO0FBQzNCO0FBQ0EsZUFBYSxFQUFFLEtBQUYsR0FBVSxPQUF2QjtBQUNBLGVBQWEsRUFBRSxLQUFGLEdBQVUsT0FBdkI7O0FBRUE7QUFDQTtBQUNBLGlCQUFlLEVBQUUsT0FBRixHQUFZLE9BQTNCO0FBQ0EsaUJBQWUsRUFBRSxPQUFGLEdBQVksT0FBM0I7O0FBRUEsR0FBQyxHQUFHLEtBQUssUUFBVCxFQUFtQixNQUFuQixFQUEyQixFQUFFLE1BQU0sYUFBYSxJQUFy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LEdBQVQsRUFBYyxHQUFkLENBQVQsSUFBK0IsU0FBUyxLQUFLLEdBQUwsQ0FBUyxHQUFULEVBQWMsR0FBZCxDQUEvQztBQUNEO0FBQ0QiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfXJldHVybiBlfSkoKSIsIid1c2Ugc3RyaWN0JztcblxudmFyIF9tYXRoID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvbWF0aC5qcycpO1xuXG52YXIgX2RvbSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2RvbS5qcycpO1xuXG52YXIgbmFtZSA9ICdwYXJraW5zb25zJztcbnZhciBjc3NVcmwgPSBjaHJvbWUuZXh0ZW5zaW9uLmdldFVSTCgnL3NpbXVsYXRpb25zL3BhcmtpbnNvbnMvY3NzL21haW4uY3NzJyk7XG52YXIgc2hha2VTcGVlZCA9IDQwO1xudmFyIHNoYWtlUG9zaXRpb25JbnRlcnZhbCA9IDI1MDtcbnZhciBhcHBWZXJzaW9uID0gbmF2aWdhdG9yLmFwcFZlcnNpb247XG5cbnZhciBjdXJzb3IgPSBudWxsLFxuICAgIHBvc0ludGVydmFsID0gbnVsbCxcbiAgICBjdXJzb3JQb3NYID0gMCxcbiAgICBjdXJzb3JQb3NZID0gMCxcbiAgICB2aWV3cG9ydFBvc1ggPSAwLFxuICAgIHZpZXdwb3J0UG9zWSA9IDAsXG4gICAgb2Zmc2V0WCA9IDAsXG4gICAgb2Zmc2V0WSA9IDAsXG4gICAgY3NzID0gbnVsbCxcbiAgICBjbGlja2VkRWxlbWVudCA9IG51bGw7XG5cbmZ1bmN0aW9uIG1vdXNlbW92ZUhhbmRsZXIoZSkge1xuICAvLyBTYXZlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmFrZSBjdXJzb3JcbiAgY3Vyc29yUG9zWCA9IGUucGFnZVggKyBvZmZzZXRYO1xuICBjdXJzb3JQb3NZID0gZS5wYWdlWSArIG9mZnNldFk7XG5cbiAgLy8gU2F2ZSB0aGUgdmlld3BvcnQgcG9zaXRpb24gb2YgdGhlIGZha2UgY3Vyc29yIChwb3NpdGlvbiB3aXRob3V0IHNjcm9sbClcbiAgLy8gV2UgdXNlIHRoaXMgbGF0ZXIgdG8gZ2V0IHRoZSBjbGlja2VkIGVsZW1lbnRcbiAgdmlld3BvcnRQb3NYID0gZS5jbGllbnRYICsgb2Zmc2V0WDtcbiAgdmlld3BvcnRQb3NZID0gZS5jbGllbnRZICsgb2Zmc2V0WTtcblxuICAoMCwgX2RvbS5zZXRTdHlsZSkoY3Vyc29yLCB7IGxlZnQ6IGN1cnNvclBvc1ggKyAncHgnLCB0b3A6IGN1cnNvclBvc1kgKyAncHgnLCB0cmFuc2l0aW9uOiAnbGVmdCAwLjA1cywgdG9wIDAuMDVzJyB9KTtcbn1cblxuZnVuY3Rpb24gZWxlbWVudENsaWNrSGFuZGxlcihlKSB7XG5cbiAgaWYgKGUudGFyZ2V0ID09PSBjbGlja2VkRWxlbWVudCkge1xuICAgIC8vIEFjdHVhbCBtb3VzZSBjbGlja2VkIGVsZW1lbnQgaXMgdGhlIHNhbWUgYXMgdGhlIGVsZW1lbnQgdGhhdCB0aGUgZmFrZSBjdXJzb3Igd291bGQgY2xpY2suXG4gICAgLy8gVGhpcyBpcyBiZWNhdXNlIHdlIHRyaWdnZXJlZCB0aGUgY2xpY2sgb3IgdGhhdCB0aGUgcG9zaXRpb25zIG9mIHRoZSBtb3VzZSBhbmQgdGhlIGZha2UgY3Vyc29yIGFyZSBib3RoIG92ZXIgdGhlIHNhbWUgZWxlbWVudC5cbiAgICAvLyBEbyBub3RoaW5nIGFuZCBwYXNzIG9uIHRoZSBjbGljay4gUmVzZXQgdGhlIGNsaWNrZWQgZWxlbWVudC5cbiAgICBjbGlja2VkRWxlbWVudCA9IG51bGw7XG4gIH0gZWxzZSB7XG4gICAgLy8gQWN0dWFsIG1vdXNlIGNsaWNrZWQgZWxlbWVudCBpcyBOT1QgdGhlIHNhbWUgYXMgdGhlIGVsZW1lbnQgdGhhdCB0aGUgZmFrZSBjdXJzb3Igd291bGQgY2xpY2suXG4gICAgLy8gR2V0IHRoZSBlbGVtZW50IHRoYXQgdGhlIGZha2UgY3Vyc29yIHdvdWxkIGNsaWNrIGFuZCB0cmlnZ2VyIGNsaWNrIG9uIHRoYXQgZWxlbWVudC5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjbGlja2VkRWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQodmlld3BvcnRQb3NYLCB2aWV3cG9ydFBvc1kpO1xuXG4gICAgaWYgKGNsaWNrZWRFbGVtZW50KSB7XG4gICAgICBjbGlja2VkRWxlbWVudC5jbGljaygpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRPZmZzZXQoKSB7XG4gIG9mZnNldFggPSAoMCwgX21hdGgucmFuZG9tKSgtc2hha2VTcGVlZCwgc2hha2VTcGVlZCk7XG4gIG9mZnNldFkgPSAoMCwgX21hdGgucmFuZG9tKSgtc2hha2VTcGVlZCwgc2hha2VTcGVlZCk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuXG4gIHZhciBjdXJzb3JJbWcgPSBhcHBWZXJzaW9uLmluY2x1ZGVzKCdNYWMnKSA/ICdjdXJzb3JfbWFjLnN2ZycgOiAnY3Vyc29yX3dpbmRvd3Muc3ZnJztcbiAgdmFyIGN1cnNvckltZ1VybCA9IGNocm9tZS5leHRlbnNpb24uZ2V0VVJMKCcvc2ltdWxhdGlvbnMvcGFya2luc29ucy9pbWcvJyArIGN1cnNvckltZyk7XG5cbiAgY3NzID0gKDAsIF9kb20uYWRkQ3NzKShjc3NVcmwpO1xuXG4gIGN1cnNvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gIGN1cnNvci5zdHlsZS5iYWNrZ3JvdW5kID0gJ3VybCgnICsgY3Vyc29ySW1nVXJsICsgJyknO1xuICBjdXJzb3Iuc2V0QXR0cmlidXRlKCdpZCcsICd3ZHMtcGFya2luc29uc0N1cnNvcicpO1xuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY3Vyc29yKTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3VzZW1vdmVIYW5kbGVyKTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGVsZW1lbnRDbGlja0hhbmRsZXIpO1xuXG4gIHBvc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoc2V0T2Zmc2V0LCBzaGFrZVBvc2l0aW9uSW50ZXJ2YWwpO1xufVxuXG5mdW5jdGlvbiBzdG9wKCkge1xuXG4gIGlmIChjdXJzb3IpIHtcbiAgICAoMCwgX2RvbS5yZW1vdmVFbGVtZW50KShjdXJzb3IpO1xuICB9XG5cbiAgaWYgKGNzcykge1xuICAgICgwLCBfZG9tLnJlbW92ZUVsZW1lbnQpKGNzcyk7XG4gIH1cblxuICBpZiAocG9zSW50ZXJ2YWwpIHtcbiAgICBjbGVhckludGVydmFsKHBvc0ludGVydmFsKTtcbiAgfVxuXG4gIC8vIFRPRE86IHJlbW92ZSBsaXN0ZW5lcnNcbn1cblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gIGlmIChyZXF1ZXN0LmFjdGlvbiA9PT0gJ3N0YXJ0U2ltdWxhdGlvbicgJiYgcmVxdWVzdC5zaW11bGF0aW9uID09PSBuYW1lKSB7XG4gICAgc3RhcnQoKTtcbiAgfSBlbHNlIGlmIChyZXF1ZXN0LmFjdGlvbiA9PT0gJ3N0b3BTaW11bGF0aW9uJyAmJiByZXF1ZXN0LnNpbXVsYXRpb24gPT09IG5hbWUpIHtcbiAgICBzdG9wKCk7XG4gIH1cbn0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29udGVudC5qcy5tYXBcbiIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuYWRkQ3NzID0gYWRkQ3NzO1xuZXhwb3J0cy5hZGRTY3JpcHQgPSBhZGRTY3JpcHQ7XG5leHBvcnRzLmFkZFN0eWxlID0gYWRkU3R5bGU7XG5leHBvcnRzLmFwcGVuZEhUTUwgPSBhcHBlbmRIVE1MO1xuZXhwb3J0cy5nZXRUZXh0Tm9kZXMgPSBnZXRUZXh0Tm9kZXM7XG5leHBvcnRzLnJlbW92ZUVsZW1lbnQgPSByZW1vdmVFbGVtZW50O1xuZXhwb3J0cy5zZXRTdHlsZSA9IHNldFN0eWxlO1xuZnVuY3Rpb24gYWRkQ3NzKGhyZWYsIGNhbGxiYWNrKSB7XG4gIHZhciBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO1xuICBsLnNldEF0dHJpYnV0ZSgnaHJlZicsIGhyZWYpO1xuICBsLnNldEF0dHJpYnV0ZSgncmVsJywgJ3N0eWxlc2hlZXQnKTtcbiAgbC5vbmxvYWQgPSBjYWxsYmFjaztcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChsKTtcbiAgcmV0dXJuIGw7XG59XG5cbmZ1bmN0aW9uIGFkZFNjcmlwdChzcmMsIGNhbGxiYWNrKSB7XG4gIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gIHMuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmMpO1xuICBzLm9ubG9hZCA9IGNhbGxiYWNrO1xuICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHMpO1xuICByZXR1cm4gcztcbn1cblxuZnVuY3Rpb24gYWRkU3R5bGUoc3RyKSB7XG4gIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgcy5pbm5lclRleHQgPSBzdHI7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQocyk7XG4gIHJldHVybiBzO1xufVxuXG5mdW5jdGlvbiBhcHBlbmRIVE1MKGVsLCBodG1sKSB7XG4gIHZhciB0bXBFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICB0bXBFbC5pbm5lckhUTUwgPSBodG1sO1xuXG4gIHdoaWxlICh0bXBFbC5maXJzdENoaWxkKSB7XG4gICAgZWwuYXBwZW5kQ2hpbGQodG1wRWwuZmlyc3RDaGlsZCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0VGV4dE5vZGVzKG5vZGUpIHtcbiAgdmFyIGFsbCA9IFtdO1xuICBmb3IgKG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7IG5vZGU7IG5vZGUgPSBub2RlLm5leHRTaWJsaW5nKSB7XG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMykgYWxsLnB1c2gobm9kZSk7ZWxzZSBhbGwgPSBhbGwuY29uY2F0KGdldFRleHROb2Rlcyhub2RlKSk7XG4gIH1cbiAgcmV0dXJuIGFsbDtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlRWxlbWVudChlbCkge1xuICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTtcbn1cblxuZnVuY3Rpb24gc2V0U3R5bGUoZWxlbWVudCwgc3R5bGUpIHtcbiAgZm9yICh2YXIgcyBpbiBzdHlsZSkge1xuICAgIGVsZW1lbnQuc3R5bGVbc10gPSBzdHlsZVtzXTtcbiAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZG9tLmpzLm1hcFxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLnJhbmRvbSA9IHJhbmRvbTtcbmV4cG9ydHMucG9pbnRJblJlY3QgPSBwb2ludEluUmVjdDtcbmV4cG9ydHMuaW5SYW5nZSA9IGluUmFuZ2U7XG5mdW5jdGlvbiByYW5kb20obWluLCBtYXgpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IobWluICsgTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7XG59XG5cbmZ1bmN0aW9uIHBvaW50SW5SZWN0KHgsIHksIHJlY3QpIHtcbiAgcmV0dXJuIGluUmFuZ2UoeCwgcmVjdC54LCByZWN0LnggKyByZWN0LndpZHRoKSAmJiBpblJhbmdlKHksIHJlY3QueSwgcmVjdC55ICsgcmVjdC5oZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBpblJhbmdlKHZhbHVlLCBtaW4sIG1heCkge1xuICByZXR1cm4gdmFsdWUgPj0gTWF0aC5taW4obWluLCBtYXgpICYmIHZhbHVlIDw9IE1hdGgubWF4KG1pbiwgbWF4KTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1hdGguanMubWFwXG4iXX0=
